---
title: "Supermarket Sweep"
author: "Adam Profili, Brynn Schneberger"
date: "4/25/2021"
output: beamer_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Project Overview

A contestant in a gameshow has a default of 90 seconds to make their way around a grocery store, collect up to a default of 15 items in their cart, and return to the start.

Their score is the total cost of the items in their cart. Items are spread around the pictured aisles, and each have specific prices and locations.

![Grocery Store Layout](map.png){height=160}

## (a) asks:

For each pair of items $i,j\in[\![1,56]\!]$, compute the shortest time $d_{ij}$ to go from item $i$ to item $j$, and store these values. You may not use any optimization software to answer this question. Compute also the shortest time to travel between the start/end location and any item.

## (a) solution:

We start first with a list of the nodes given in the Supermarket Sweep.csv file, each wrapped in an Item object that holds its x, y, and price attributes.

If two items are on the same x-aisle, the shortest distance from one to the other is the absolute value of the difference between their y-coordinates. We then divide the distance by the contestant's speed, 10 feet/second to convert this calculation to time.

If two items are on different x-aisle, the shortest distance from one to the other is either by moving up to the end of the aisle, across to the other item's aisle, and then down to the item, or by moving down to the start of the aisle, across to the other item's aisle, and then up to the item. An algorithm should choose the shortest of these two options, which could be done by taking the minimum of the two or by finding if the two item's y-values on average are closer to the end (110 ft) or the beginning (0 ft). We then divide the distance by the contestant's speed, 10 feet/second to convert this distance to time.

Then two seconds is added to each time between nodes to account for the time it takes for a contestant to pick up the $j^\textrm{th}$ node.

## (b) asks:

Formulate the Supermarket Sweep problem as a Mixed-Integer Program.

## (b) Data Placeholders:

$n$ represents the number of nodes, with node 1 being the start node, nodes 2,3,...,n being item nodes, and n+1 being the end node which shares the attributes of the start node.

$T$ represents the maximum time the contestant is given to shop.

$C$ represents the maximum amount of items the contestant can put in their cart.

$v_{i}$ represents the value of node $i$. $\forall i = 1, 2, ..., n$

$d_{ij}$ represents the minimum time it takes to move from node $i$ to node $j$. If node $j$ represents an item and not a start/end point, it will include the 2 seconds to add that item to the cart. $\forall i = 1, 2, ..., n$ $\forall j = 2, 3, ..., n+1$


## (b) Decision Variables:

$x_{ij} = 1$ if node $j$ follows node $i$ in the chosen path, 0 otherwise. $\forall i = 1, 2, ..., n$ $\forall j = 2, 3, ..., n+1$

$y_{j} = 1$ if node $j$ follows node $i$ in the chosen path, 0 otherwise. $\forall j = 1, 2, ..., n+1$

$t_{ij} = y_{j}$ if node $j$ follows node $i$ in the chosen path, 0 otherwise. $\forall i = 1, 2, ..., n$ $\forall j = 2, 3, ..., n+1$

## (b) Objective:

$$
\begin{aligned}
&\max_{x, y, t} &\textrm{score}&=\sum_{i=1}^nv_i\sum_{j=2}^{n+1}x_{ij}
\end{aligned}
$$

## (b) Constraint (1)

$$
\begin{aligned}
y_1 &= 0 \\ \\
\end{aligned}
$$


## (b) Constraint (2)

$$
\begin{aligned}
\sum_{j=2}^{n+1}x_{1,j}&=1
\end{aligned}
$$

## (b) Constraint (3)

$$
\begin{aligned}
\sum_{j=2}^{n+1}x_{ij}&\le1 &\forall i \in [\![2, n]\!]
\end{aligned}
$$

## (b) Constraint (4)

$$
\begin{aligned}
\sum_{j=2}^{n+1}x_{ij}&\le1 &\forall i \in [\![2, n]\!]
\end{aligned}
$$

## (b) Constraint (3)

$$
\begin{aligned}
\sum_{i=1}^{n}x_{ij}&\le1 &\forall j \in [\![2, n]\!]
\end{aligned}
$$

## (b) Constraint (5)

$$
\begin{aligned}
\sum_{i=1}^{n}x_{i,n+1}&=1
\end{aligned}
$$

## (b) Constraint (6)

$$
\begin{aligned}
t_{ij}&\le T x_{ij} &\forall i \in [\![1, n]\!] \ \ \ \ \ \ &\forall j \in [\![2, n+1]\!]
\end{aligned}
$$

## (b) Constraint (7)

$$
\begin{aligned}
y_j &= \sum_{i=1}^n t_{ij} &\forall j \in [\![2, n+1]\!]
\end{aligned}
$$

## (b) Constraint (8)

$$
\begin{aligned}
\sum_{k=2}^{n+1} t_{jk} &= y_j + \sum_{k=2}^{n+1} d_{jk}x_{jk} &\forall j \in [\![1, n]\!]
\end{aligned}
$$

## (b) Constraint (9)

$$
\begin{aligned}
x_{ii} &= 0 &\forall i \in [\![1, n]\!]
\end{aligned}
$$

## (b) Constraint (10)

$$
\begin{aligned}
\sum_{i=1}^{n}x_{ij}&= \sum_{k=2}^{n+1}x_{jk}  &\forall j \in [\![2, n]\!]
\end{aligned}
$$

## (b) Constraint (11)

$$
\begin{aligned}
\sum_{i=1}^n\sum_{j=2}^{n}x_{ij} &\le C
\end{aligned}
$$

## (b) Bound Constraints

$$
\begin{aligned}
x_{ij} &\in \{0,1\} &\forall i \in [\![1, n]\!] \ \ \ \ \ \ &\forall j \in [\![2, n+1]\!] \\ \\
t_{ij} &\ge 0 &\forall i \in [\![1, n]\!] \ \ \ \ \ \ &\forall j \in [\![2, n+1]\!]
\end{aligned}
$$



## (c) asks:

Code and solve your optimization model.  What is the optimal path?  Which items are picked?  What is the total value of these items?

## (c) solution:

Refer to code output

## (d) asks:

How does the optimal value of the problem vary with respect to the total amount of time allowed (initially set to 90 sec)?  Answer this question by plotting and analyzing the optimal value of the problem with different values of the total amount of time that is allowed.

## (d) solution:






## (e) asks:

How does the optimal value of the problem vary with respect to the capacity of the cart (initially set to 15)?  Answer this question by plotting and analyzing the optimal value of the problem with different values of the cart capacity.

## (e) solution:







## (f) asks:

Consider the initial parameters of the problem (cart of size 15, time allowed of 90 seconds). Gurobi  has  a  parameter  called  MIPGap. Its  default  value  is  0.0001. This  means that Gurobi will output a solution, as soon as its objective value is within 0.01% of the optimal value of the problem. Changing  this parameter will influence the time it takes Gurobi to output a solution.  What happens if you change this Gurobi parameter for the Supermarket Sweep  problem?   Answer  this  question  by  plotting  and  analyzing  the  time  Gurobi  takes  to output  a  solution  with  respect  to  the  optimality  gap  that  is  allowed.

## (f) solution: